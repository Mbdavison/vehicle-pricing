{% extends "base.html" %}

{% block content %}
<h2>Historical Vehicles</h2>
<p class="small">Filter by state and company to see the most recent 1000 records.</p>

<form method="get" action="/history" class="mt-2">
    <div class="flex gap-4 flex-wrap">
        <div class="w-1-2">
            <label for="state">State</label>
            <select id="state" name="state">
                <option value="">All</option>
                {% for s in states %}
                    <option value="{{ s }}" {% if selected_state == s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="w-1-2">
            <label for="company">Company</label>
            <select id="company" name="company">
                <option value="">All</option>
                {% for c in companies %}
                    <option value="{{ c }}" {% if selected_company == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="mt-3">
        <button type="submit">Apply Filters</button>
    </div>
</form>

{% if vehicles %}
<table class="mt-4">
    <thead>
    <tr>
        <th>ID</th>
        <th>VIN</th>
        <th>Year</th>
        <th>Make</th>
        <th>Model</th>
        <th>Mileage</th>
        <th>Sale Price</th>
        <th>Title Status</th>
        <th>State</th>
        <th>Company</th>
        <th>Source File</th>
    </tr>
    </thead>
    <tbody>
    {% for v in vehicles %}
    <tr>
        <td>{{ v.id }}</td>
        <td>{{ v.vin }}</td>
        <td>{{ v.year }}</td>
        <td>{{ v.make }}</td>
        <td>{{ v.model }}</td>
        <td>{{ v.mileage }}</td>
        <td>{{ "%.2f"|format(v.sale_price) if v.sale_price is not none else "" }}</td>
        <td>{{ v.title_status }}</td>
        <td>{{ v.state }}</td>
        <td>{{ v.company }}</td>
        <td>{{ v.source_file }}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="mt-3 small">No vehicles found for the selected filters.</p>
{% endif %}
{% endblock %}

